はじめに
//500word
背景
//GFPと遺伝子組み換え動物の説明と小型顕微鏡の解説
//1000word


既存手法説明(1000words)
　
前章で説明したように自由に行動するマウスの脳の神経細胞の活動をとらえることが可能である。しかし、得られる情報は基本的にノイズの多い映像データである。
　このデータの解析を科学的に解析するためにいくつかのアルゴリズムが提案されている。
カルシウムイベントは映像データの一部分のみであるため、ノイズを除去したのち映像データに対する異常検知という形式にアルゴリズムを落とし込むことが多い。
多くのアルゴリズムは二光子顕微鏡用に最適化されているため、そのまま自由行動を伴う一光子顕微鏡データを扱うことはできない。
一光子顕微鏡用のアルゴリズムの多くは二光子顕微鏡に適合されたアルゴリズムを一光子顕微鏡用に改良を加えたものである。
　独立成分分析/主成分分析(PCA/ICA)により、カルシウムイベントの位置、カルシウムイベントの生起時間を推定する方法が最も古くから存在する。しかし、その後に出てきた手法より背景ノイズに影響されやすく性能は低い。また、重なり合ったニューロンを摘出できないなどの明らかな欠点を持つ。
　CNMFは制約付き非負値分解を基盤とした方法であり、二光子顕微鏡用のカルシウムイベント検知アルゴリズムである。映像データを巨大なマトリクスととらえ、時間情報を持つ行列と位置情報を持つ行列に分解するというのが基盤のアイデアである。行列の非負値分解のペアは無数に存在するため、「制限」を付けて計算する。
　CNMFは二光子顕微鏡に最適化されているため、一光子顕微鏡用にアルゴリズムを拡張したのがCNMF_Eである。CNMF_Eは二光子顕微鏡には存在しない背景ノイズの処理が加わっているが、中心となるアルゴリズムは同じである。
　CNMF_Eの実装上の特徴として、カルシウムイベントの生起と疑われる位置画像をすべて抽出し人間が目視で確認する作業を含む。
　一光子顕微鏡のアルゴリズムで人間の作業を減らした手法としてCNNや混合ベイズ分布などの機械学習手法を組み入れたMIN1PIPEが存在する。MIN1PIPEは人手の作業が全く必要ないが、トレードオフとしてパラメーター変更が行いづらい。
　さらに新しいフレームワークとしてpythonのライブラリであるCaImAnが存在する。これは二光子顕微鏡用、一光子顕微鏡用、またリアルタイム判定なども含んだ大規模なライブラリである。
CaImAnのカルシウムイベント検出アルゴリズムはCNMF及びCNMF_Eに準拠している。
CaImAnとCNMF_Eの違いはプログラム言語が違うだけだが,MIN1PIPEはその二つとノイズ分離などの手法も大きく違う。
問題提起(500/1000words)
 
神経細胞の活動の計測技術はカルシウムイメージング技術において重要な一要素である。
より詳細に神経細胞のカルシウムイメージングを計測することはより詳細に神経細胞の活動を理解することにつながる。カルシウムイメージングにおいて基盤となる技術は以下の3つである。1つは細胞内のカルシウムイメージングセンサーの反応精度,2つ目はマウスの頭につける顕微鏡の工作精度,3つ目は映像からカルシウムセンサーの反応を摘出するアルゴリズムの精度。
3のアルゴリズムの精度について述べる。複数のアルゴリズムが目的に応じて発案されている。CNMF_EやCaImAn以外にも,目的に応じた様々な神経細胞の活動のイメージング手法が存在する。＊
より良いアルゴリズムの存在はより詳細な細胞活動の計測を可能とする。しかし、アルゴリズムの違いは計測結果の違いを生む。そのため、新しく開発された手法による結果と古くから使われている手法による結果をそのまま比較することは実験の解釈に影響を及ぼす。
アルゴリズムの違いが計測結果にどのくらいの違いを及ぼすのかをしることができれば、実験の結果の差異のうちどの部分が手法の差異によるものなのか知るだけでなく,より適切なアルゴリズムを実験目的ごとに選ぶことが可能である。
　摘出された神経細胞の活動が手法により、どのくらい変化するかを明らかにするのが本論文の目的である。比較する手法はCaImAnとMIN1PIPEである。


実験1(900/1000words)

CNMF＿Eアルゴリズム自体は広く使われているアルゴリズムである。MATLABで作成されたオープンソースコードが存在し、研究者、技術者が状況に応じてパラメーターを変更し広く使われている。
しかし、CaImAnのフレームワークは2019年に論文が発表された新しい実装である。この手法とMIN1PIPの手法とでどのくらい摘出するニューロンが変わるのかを比較した。

MIN1PIPEの手法で対象とされていたデモデータをMIN1PIPE及び,CaImAnで解析し、結果を比較した。


MIN1PIPEのデモデータをMIN1PIPE(MATLAB)で解析した。このとき、解析パラメータなどの変更はできるかぎりせずに、デモと同じように動かした。
58個のニューロンが検出できた。
MIN1PIPEのデモデータをCaImAn(python)で解析した。この際のパラメーターはデフォルト値である。デフォルトの値以外にもパラメーターを変更したが、一番良い結果を示すパラメーターはデフォルト値であった。
57個のニューロンが検出できた。
　同数のニューロンが検出できたが、同一のニューロンを摘出していることは保証されない。
MIN1PIPEとCaImAnが同一のニューロン及びカルシウムイベントを検出できているかを確認し、片方のみで摘出される場合はどのような性質を持つニューロンなのかを調べる。
MIN1PIPE,CaImAnともに摘出したニューロンひとつづつに対し、対応する[位置情報]と[カルシウムイベントの時系列データ]を持つ。
　位置情報についてMIN1PIPEはすべてのニューロンに対し、直径3から6ピクセルの円であるがCaImAnではより広い領域を持つ。
系列データは両手法ともにノイズを除いただけのカルシウムイベント由来の光量データほか、両手法内でスパイク系列を予測し、スパイク系列データとした系列データも出力する。
　これらが61個のセット存在する。

このようにして得られたMIN1PIPEが摘出したニューロンの場所,スパイク系列セット57個とCaImAnが摘出したニューロンの場所,スパイク系列セット61個を比較した。
第一に場所距離を比較し、十分に近い場合、同一ニューロンと仮定した。次にスパイク系列を比較し、同一場所からニューロンを摘出している場合、類似したスパイク系列を摘出しているのかどうか確認した。








実験1のデータ

//MIN1PIPEのデモデータの説明(470/500words)

本当の神経細胞の活動(ground truth)を我々が知ることはできない。そのため、多くの発案手法において信頼度を確認するときは疑似データを人工的に作成するか,熟練の研究者や技術員が人手でアノテーションしたデータをデータセットとして扱うことが多い。本論文ではアノテーション付きのデータは使用していない。
MIN1PIPEの手法発案で扱われているデモデータを対象とした。これには理由がある。

1つ目はカルシウムイメージングデータであり、人工的に作成したデータよりも実際の実験状況と近いためである。
2つ目はMIN1PIPEによる解析が上手くいくということが論文で提唱されているため、MIN1PIPEの結果を真の神経細胞の活動に近いとして扱えるためである。

データはMIN1PIPEのデモデータはUCLA minscopeを使って得られた画像であり,min1pipeのgithubリポジトリに存在する。以下から得ることができる。
https://github.com/JinghaoLu/MIN1PIPE/blob/master/demo/demo_data.tif


実験
距離の比較結果(1300/1000words)

位置情報が十分に近傍である場合,同一のニューロンだと推定できる。
しかし、MIN1PIPEとCaImAnでニューロンの推定位置情報の表記方法が大きく異なる。
縦横150ピクセルの画像に対し、左上を0,右下を25500とした一次元数列として、画像をとらえている点では同じだが、解析結果としてMIN1PIPEは点のみを返し、CaImAnは面積を返す。
min1pipeでは点として摘出され、そのうえで半径3～6ピクセルの円(もしくは楕円)をニューロンの場所として抽出している。
プログラムのコード上の結果としてMATLABの結果変数として一次元の数値の配列として取り出される。
解析結果として58個の数値が返ってくる。
この数値が各ニューロン位置の中心を表している
CaImAnではより広い面積として塗りつぶされている。
25500*60の疎行列に各ピクセルが各ニューロンに含まれない場合0,そうでない場合,数値がふくまれている。0以外の数値の部分がニューロンとして摘出された部分である。
つまり、min1pipeとcaimanを比較するためには点と点群を比較する必要がある。

1,CaImAnで摘出されたニューロンを現す点群がmin1pipeの点を含む場合が存在する。
その場合,同一のニューロンを摘出できている可能性が非常に高い。


2,独自定義の距離(詳しくは付録C)

点群と点を測る距離を独自定義して使用して比較した。点群の重心を扱う方法は扱わない。
なぜなら左右に長いニューロンの場合、間違った計算をしてしまうからである。

　一点Aと点群に含まれる点B1のユークリッド距離を算出する
　点B1からBnまで上の操作を繰り返す。
  A-B1,~A-Bnの全ての平均をとる。

これによって検出した距離が十分に近い場合は同一ニューロンのカルシウムイベントの位置情報を検出できている可能性が高い。
　Min1pipeで摘出された推定ニューロン位置とCaimanで摘出された推定ニューロン位置にの独自定義距離においてすべての平均は、71.64ピクセル,中央値は69.38ピクセル,全体の標準偏差は38.38,最小値は5.67,最大値は182.39となった。計算はnumpyで行い小数点三桁以下を切り捨ててある。
Min1pipeを基準とし、Caimanの摘出ニューロン61個との距離を測ったより詳しい結果は付属Aのようになった。

独自距離が10以下の場合,MIN1PIPEのポイントをcaimanの面積が含むことが多い。
20~30の場合,近傍ではあるが、caimanの面積部とmin1pipeの点が明らかに離れている。
Min1pipeの結果が検出した各ニューロンに対し,caimanが検出した各ニューロンとの独自定義距離を測り、各独自定義距離が最小になるcaimanが摘出したニューロンがmin1pipeの摘出したニューロンと対応すると考えられる。ほとんどの場合,対応づくと思われるニューロンはかなり近傍にあり、独自定義距離は20以下であった。(付属B)しかし20を超える場合が6回あった。つまり,min1pipeが摘出できているが、caimanが同位置で検出していないニューロンが最低でも6個存在する可能性がある。







スパイク系列の比較結果(400/1000words)

Min1pipe,caimaともに神経細胞の発火をスパイク系列として取り出す。同じよう形の時系列データとして摘出する。
スパイク系列の類似度を比較しmin1pipeとcaimanが同じようにスパイク系列データを摘出可能なのかどうかを確かめた。
系列データの類似度計算には様々な手法が存在する。しかし、今回は系列の長さは決まっており、それに対する摘出情報の比較であるため、動的計画法などの系列データが可変長でも比較できる手法は扱わない。単純なハミング距離も扱わない。なぜなら0部分が多い系列の類似度が不必要にあがるためである。Caimanとmin1pipeで摘出データの時間数は一致しても縦軸のスケールが大きく違うため、ユークリッド距離も扱いにくい。
そのため、ハミング距離に閾値を入れた独自定義の距離で比較した。


Min1pipeの各摘出スパイク系列に対し,caimanのスパイク系列のうち類似度が最大となるもの,つまり系列距離が最小となるものを同一ニューロンと推定した。
閾値入りハミング距離の平均は,

min1pipeが摘出したニューロンを基準とし、最も閾値入りハミング距離が近いcaimanのニューロンの場所距離が近いかどうか確認した。場所距離は独自定義の距離を使った。
近傍にあると考えられる20以下の距離であるのは58個のうち**個であった。


位置距離とスパイク系列類似度と両方を使用した場合.(1000words)

位置情報だけでは,同じニューロンであるという確証は得られない。なぜなら、ニューロンどうしは重なり合うことがあるためである。逆にスパイク系列が同士の類似度がどれほど高くても、場所が違えばそれは同じニューロンではない。
よって場所情報と系列データの両方を使って同一ニューロンを摘出できているかどうか確認した。最終的は以下のように評価した。

原理的には以下のように検出イベントを場合分けできる。

A群:位置情報が良く一致、スパイク系列も良く一致
B群:位置情報が良く一致、スパイク系列はそこまで一致しない
C群:位置情報がしない,スパイク系列は良く一致
D群:位置情報,スパイク系列ともに一致しない

しかし、位置情報が一致しない場合明らかに同一のニューロンではないこととmin1pipeの側がground truthに近いことがわかっていることを考慮し、min1pipeを基準とし,1,場所が一致するかどうか,2場所が一致するならスパイク系列類似度が高いかを判定していった。


詳細な結果は附録D



考察(800/1000words)

//min1pipeとcaiman(cnmf_e)の違い
以上のように解析方法により、解析結果に違いがあることが確認できた。
ニューロンの数はmin1pipeでもCaImAnでもほぼ同数検出が可能だが、MIN1PIPEでのみ摘出されているニューロンおよび、CaImAnでのみ検出されているニューロンが存在する。距離に関してCaImAnの摘出点群がMIN1PIPEの摘出点を含むことは多い。しかし、同一のニューロンを摘出している場合でも系列データの違いなどから同一の特徴で同一のニューロンを摘出している可能性は低いということが確認できた。MIN1PIPEとCaImAnの基礎のアルゴリズムが違うためだと推測できる。
　また、min1pipeとcaimanにおいて最近傍にあるニューロンのスパイク系列の類似度がそのまま通常のハミング距離やユークリッド距離で最も類似度が高くなるわけではない。
アルゴリズムの違いにより系列データの形も異なる。場所が同一と推定されるニューロンどうしで全く一致しない系列データを持つ場合が存在する。この場合,考えられる可能性は二つある。
　1つ目はMINPIPEとcaimanのスパイク系列の摘出アルゴリズムの違いの影響が非常に大きい可能性である。時系列データであるスパイク系列の摘出において動画の[ブレ]の動きは影響が大きい。Min1pipeとCaImAnでは動きを補正する方法が違う。そのため、動き補正の違いが大きく影響していることが考えられる。また、CaImAnとMIN1PIPEの摘出ニューロンの形状が面積であるか点であるかも影響していう可能性が大きい。
　2つ目はMIN1PIPEとCaImAnが摘出しているニューロンが重なり合っているだけの違うニューロンである可能性である。今回扱っているデータは1光子顕微鏡であり、データは上から見た映像データであり、重なり合っているニューロンを識別することは原理的に不可能である。
　また、少数ながら,CaImAnが誤検出したニューロンが存在する。(附録E)これは形状が明らかにニューロンではないが,系列データが典型的なスパイクとして摘出されている場合である。このことからCaImAnはスパイク系列データを優先してニューロンを判別する傾向があり、形状の形によるニューロンの判別は苦手であることがわかる。



結論(1000words)

手法によるアルゴリズムの違いは系列データに与える違いが大きい。
(MIN1PIPEはむっちゃ使いにくい）
CaImAnは
MIN1PIPEでもCaImAnでも高い一致率で同位置のニューロンを摘出可能である。
しかし、同位置だと推定されるニューロン同士でもスパイク系列はそこまで一致しない.

